<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8" />
    <title>Explore Books - BookTracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../static/css/styles.css" />
    <style>
        .search-bar {
            display: flex;
            gap: 0.5rem;
            max-width: 600px;
            margin: 0 auto 2rem auto;
            flex-wrap: wrap;
            justify-content: center;
        }
        .search-bar input[type="text"] {
            flex: 1;
            min-width: 180px;
            padding: 0.75rem;
            font-size: 1.1rem;
            border: 1px solid #ced4da;
            border-radius: 0.5rem;
        }
        .search-bar button {
            padding: 0.75rem 1.5rem;
            font-size: 1.1rem;
            border-radius: 0.5rem;
            border: none;
            background: #0d6efd;
            color: #fff;
            font-weight: 500;
        }
        .books-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
            margin-top: 2rem;
        }
        .book-card {
            background: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 170px;
            max-width: 200px;
            min-height: 320px;
            transition: transform 0.15s;
        }
        .book-card:hover {
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 4px 16px rgba(0,0,0,0.13);
        }
        .book-card img {
            width: 110px;
            height: 160px;
            object-fit: cover;
            border-radius: 0.25rem;
            margin-bottom: 0.75rem;
        }
        .book-title {
            font-weight: 600;
            font-size: 1.05rem;
            margin-bottom: 0.25rem;
            text-align: center;
            max-width: 180px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .book-author {
            font-size: 0.96rem;
            color: #0d6efd;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        .book-desc {
            font-size: 0.92rem;
            color: #555;
            text-align: center;
        }

        [data-bs-theme="dark"] .book-card {
            background: #2b3038;
        }

        
        [data-bs-theme="dark"] .book-desc {
            color: #fff;
        }
    </style>
</head>
<body class="bg-body">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{{ url_for('main.dashboard') }}">BookTracker</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <div class="navbar-nav">
                    <a class="nav-link" href="{{ url_for('main.dashboard') }}">Dashboard</a>
                    <a class="nav-link active fw-semibold" aria-current="page" href="{{ url_for('main.explore') }}">Explore</a>
                    <a class="nav-link" href="{{ url_for('main.library') }}">Library</a>
                    <a class="nav-link" href="{{ url_for('main.community') }}">Community</a>
                    <a class="nav-link" href="{{ url_for('main.statistics') }}">Statistics</a>
                    <a class="nav-link" href="{{ url_for('main.logout') }}">Sign Out</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container my-5 p-4 rounded shadow-sm bg-body main-container">
        <h2 class="fw-semibold text-primary mb-4">Explore Books</h2>
        <form class="search-bar" id="searchForm" autocomplete="off">
            <input type="text" id="searchInput" placeholder="Search for books by title, author, or keyword..." autocomplete="off">
            <button type="submit">Search</button>
        </form>
        <h4 id="resultsTitle" class="mb-4">Trending Books</h4>
        <div class="books-grid" id="booksGrid"></div>
    </div>

    <!-- Footer (same as other pages) -->
    <footer class="text-center text-muted mt-5 mb-3 small">
        <div class="mb-2">
            <a href="https://www.facebook.com/" class="text-decoration-none text-primary mx-2">Facebook</a> ·
            <a href="https://www.x.com/" class="text-decoration-none text-primary mx-2">Twitter</a> ·
            <a href="https://www.instagram.com/" class="text-decoration-none text-primary mx-2">Instagram</a>
        </div>
        <div class="mb-2">
            <a href="#" id="darkModeToggleLink" class="text-decoration-none text-primary mx-2"><span id="darkModeStatus">Dark Mode</span></a> ·
            <a href="{{ url_for('main.contact') }}" class="text-decoration-none text-primary mx-2">Contact</a>
        </div>
        <div>
            <a href="{{ url_for('main.terms') }}" class="text-decoration-none text-primary mx-2">Terms & Conditions</a> ·
            <a href="{{ url_for('main.policy') }}" class="text-decoration-none text-primary mx-2">Privacy Policy</a> ·
            <a href="{{ url_for('main.copyright') }}" class="text-decoration-none text-primary mx-2">Copyright</a>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/dark.js') }}"></script>
    <script>
        // Utility to fetch books from Google Books API
        async function fetchBooks(query, maxResults = 20, orderBy = 'relevance') {
            const url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=${maxResults}&orderBy=${orderBy}`;
            const resp = await fetch(url);
            const data = await resp.json();
            return (data.items || []);
        }
        function truncateTitle(title, maxLength = 50) {
            return title.length > maxLength ? title.substring(0, maxLength - 1) + '…' : title;
        }
        function renderBooks(books) {
            const grid = document.getElementById('booksGrid');
            grid.innerHTML = '';
            if (books.length === 0) {
                grid.innerHTML = '<p style="text-align:center; color:#888; width:100%;">No books found.</p>';
                return;
            }
            books.forEach(book => {
                const info = book.volumeInfo || {};
                const img = (info.imageLinks && info.imageLinks.thumbnail) || 'https://via.placeholder.com/110x160?text=No+Cover';
                const title = info.title ? truncateTitle(info.title) : 'No Title';
                const authors = (info.authors && info.authors.join(', ')) || 'Unknown Author';
                const desc = info.description ? info.description.substring(0, 80) + (info.description.length > 80 ? '…' : '') : '';
                const detailsUrl = `/details?googleid=${book.id}`;
                const card = document.createElement('a');
                card.className = 'book-card';
                card.href = detailsUrl;
                card.style.textDecoration = 'none'; // Optional: removes underline from link
                card.innerHTML = `
                    <img src="${img}" alt="Book cover">
                    <div class="book-title" title="${info.title || ''}">${title}</div>
                    <div class="book-author">${authors}</div>
                    <div class="book-desc">${desc}</div>
                `;

                grid.appendChild(card);
            });
        }
        async function loadTrendingBooks() {
            document.getElementById('resultsTitle').textContent = 'Trending Books';
            const trendingBooks = await fetchBooks('bestsellers', 20, 'relevance');
            renderBooks(trendingBooks);
        }
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                loadTrendingBooks();
                return;
            }
            document.getElementById('resultsTitle').textContent = `Search Results for "${query}"`;
            const books = await fetchBooks(query, 20, 'relevance');
            renderBooks(books);
        });
        loadTrendingBooks();
    </script>
</body>
</html>
